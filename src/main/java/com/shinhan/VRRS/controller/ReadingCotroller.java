package com.shinhan.VRRS.controller;

import com.shinhan.VRRS.dto.*;
import com.shinhan.VRRS.entity.Product;
import com.shinhan.VRRS.service.ProductService;
import com.shinhan.VRRS.service.RecommendationService;
import com.shinhan.VRRS.service.ReadingService;
import com.shinhan.VRRS.service.OcrService;
import com.shinhan.VRRS.util.IngredientUtil;
import jakarta.validation.Valid;
import lombok.RequiredArgsConstructor;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.multipart.MultipartFile;

import java.util.Collections;
import java.util.List;

@RestController
@RequestMapping("/reading")
@RequiredArgsConstructor
public class ReadingCotroller {
    private final OcrService ocrService;
    private final ProductService productService;
    private final ReadingService readingService;
    private final RecommendationService recommendationService;

    // 텍스트 호출
    @PostMapping("/ocr")
    public ResponseEntity<OcrResponse> callOcr(@RequestParam("file") MultipartFile file) {
        OcrResponse processedText = new OcrResponse();
        try {
//            StringBuffer ocrResponse = ocrService.callOcr(file); // 클로바 OCR API 호출

            // 테스트용 코드
            String ocrResponse =  "{\"version\":\"V2\",\"requestId\":\"d8bde9269f3a43f0bfe3a436f9785547\",\"timestamp\":1727148146430,\"images\":[{\"uid\":\"2747489513b547beb3267e95d2dca241\",\"name\":\"demo\",\"inferResult\":\"SUCCESS\",\"message\":\"SUCCESS\",\"validationResult\":{\"result\":\"NO_REQUESTED\"},\"convertedImageInfo\":{\"width\":647,\"height\":858,\"pageIndex\":0,\"longImage\":false},\"fields\":[{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":17.0,\"y\":11.0},{\"x\":284.0,\"y\":21.0},{\"x\":282.0,\"y\":73.0},{\"x\":16.0,\"y\":62.0}]},\"inferText\":\"원재료명 및 함량\",\"inferConfidence\":0.9984,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":13.0,\"y\":71.0},{\"x\":90.0,\"y\":71.0},{\"x\":90.0,\"y\":123.0},{\"x\":13.0,\"y\":123.0}]},\"inferText\":\"제품명\",\"inferConfidence\":0.9999,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":106.0,\"y\":70.0},{\"x\":334.0,\"y\":82.0},{\"x\":331.0,\"y\":136.0},{\"x\":103.0,\"y\":125.0}]},\"inferText\":\"다시다골드쇠고기\",\"inferConfidence\":0.9999,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":347.0,\"y\":86.0},{\"x\":407.0,\"y\":86.0},{\"x\":407.0,\"y\":136.0},{\"x\":347.0,\"y\":136.0}]},\"inferText\":\"식품의\",\"inferConfidence\":0.9995,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":397.0,\"y\":90.0},{\"x\":440.0,\"y\":90.0},{\"x\":440.0,\"y\":136.0},{\"x\":397.0,\"y\":136.0}]},\"inferText\":\"유형\",\"inferConfidence\":0.9998,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":443.0,\"y\":85.0},{\"x\":607.0,\"y\":92.0},{\"x\":605.0,\"y\":150.0},{\"x\":441.0,\"y\":143.0}]},\"inferText\":\"복합조미식품\",\"inferConfidence\":0.9998,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":617.0,\"y\":112.0},{\"x\":630.0,\"y\":112.0},{\"x\":630.0,\"y\":127.0},{\"x\":617.0,\"y\":127.0}]},\"inferText\":\"·\",\"inferConfidence\":0.998,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":629.0,\"y\":105.0},{\"x\":644.0,\"y\":105.0},{\"x\":644.0,\"y\":133.0},{\"x\":629.0,\"y\":133.0}]},\"inferText\":\"0\",\"inferConfidence\":0.9808,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":16.0,\"y\":130.0},{\"x\":88.0,\"y\":130.0},{\"x\":88.0,\"y\":183.0},{\"x\":16.0,\"y\":183.0}]},\"inferText\":\"제조원\",\"inferConfidence\":0.9996,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":103.0,\"y\":127.0},{\"x\":352.0,\"y\":136.0},{\"x\":349.0,\"y\":198.0},{\"x\":101.0,\"y\":189.0}]},\"inferText\":\"씨제이제일제당주식회사\",\"inferConfidence\":0.9994,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":340.0,\"y\":138.0},{\"x\":455.0,\"y\":140.0},{\"x\":454.0,\"y\":198.0},{\"x\":339.0,\"y\":196.0}]},\"inferText\":\"부산광역시\",\"inferConfidence\":0.9992,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":444.0,\"y\":142.0},{\"x\":518.0,\"y\":142.0},{\"x\":518.0,\"y\":198.0},{\"x\":444.0,\"y\":198.0}]},\"inferText\":\"사하구\",\"inferConfidence\":1.0,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":508.0,\"y\":145.0},{\"x\":581.0,\"y\":145.0},{\"x\":581.0,\"y\":199.0},{\"x\":508.0,\"y\":199.0}]},\"inferText\":\"다대로\",\"inferConfidence\":1.0,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":570.0,\"y\":149.0},{\"x\":616.0,\"y\":149.0},{\"x\":616.0,\"y\":194.0},{\"x\":570.0,\"y\":194.0}]},\"inferText\":\"210\",\"inferConfidence\":0.9879,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":3.0,\"y\":188.0},{\"x\":103.0,\"y\":190.0},{\"x\":102.0,\"y\":243.0},{\"x\":2.0,\"y\":242.0}]},\"inferText\":\"유통기한\",\"inferConfidence\":1.0,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":105.0,\"y\":186.0},{\"x\":315.0,\"y\":188.0},{\"x\":315.0,\"y\":250.0},{\"x\":105.0,\"y\":248.0}]},\"inferText\":\"후면표기일까지\",\"inferConfidence\":0.9999,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":365.0,\"y\":198.0},{\"x\":435.0,\"y\":198.0},{\"x\":435.0,\"y\":246.0},{\"x\":365.0,\"y\":246.0}]},\"inferText\":\"내용량\",\"inferConfidence\":1.0,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":450.0,\"y\":198.0},{\"x\":511.0,\"y\":198.0},{\"x\":511.0,\"y\":247.0},{\"x\":450.0,\"y\":247.0}]},\"inferText\":\"250\",\"inferConfidence\":1.0,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":509.0,\"y\":211.0},{\"x\":532.0,\"y\":211.0},{\"x\":532.0,\"y\":247.0},{\"x\":509.0,\"y\":247.0}]},\"inferText\":\"g\",\"inferConfidence\":0.9999,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":103.0,\"y\":249.0},{\"x\":230.0,\"y\":249.0},{\"x\":230.0,\"y\":312.0},{\"x\":103.0,\"y\":312.0}]},\"inferText\":\"천일염(국산),\",\"inferConfidence\":0.9999,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":216.0,\"y\":252.0},{\"x\":628.0,\"y\":249.0},{\"x\":629.0,\"y\":307.0},{\"x\":217.0,\"y\":311.0}]},\"inferText\":\"한우맛내기분말골드(혼합양념분말골드(중국산), 농축\",\"inferConfidence\":0.954,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":104.0,\"y\":306.0},{\"x\":358.0,\"y\":303.0},{\"x\":359.0,\"y\":365.0},{\"x\":105.0,\"y\":368.0}]},\"inferText\":\"간장분말(탈지대두:외국산),\",\"inferConfidence\":0.9989,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":346.0,\"y\":307.0},{\"x\":633.0,\"y\":301.0},{\"x\":634.0,\"y\":357.0},{\"x\":347.0,\"y\":364.0}]},\"inferText\":\"한우쇠고기분말(한우쇠고기:국산),\",\"inferConfidence\":0.9894,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":108.0,\"y\":365.0},{\"x\":422.0,\"y\":364.0},{\"x\":422.0,\"y\":421.0},{\"x\":108.0,\"y\":422.0}]},\"inferText\":\"후추가루],L-글루탐산나트륨(향미증진제),\",\"inferConfidence\":0.9673,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":411.0,\"y\":364.0},{\"x\":473.0,\"y\":364.0},{\"x\":473.0,\"y\":410.0},{\"x\":411.0,\"y\":410.0}]},\"inferText\":\",포도당,\",\"inferConfidence\":0.9984,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":463.0,\"y\":362.0},{\"x\":525.0,\"y\":362.0},{\"x\":525.0,\"y\":411.0},{\"x\":463.0,\"y\":411.0}]},\"inferText\":\",백설탕,\",\"inferConfidence\":0.8925,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":512.0,\"y\":354.0},{\"x\":634.0,\"y\":353.0},{\"x\":635.0,\"y\":413.0},{\"x\":513.0,\"y\":414.0}]},\"inferText\":\", 농축간장[탈지\",\"inferConfidence\":0.9449,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":15.0,\"y\":451.0},{\"x\":108.0,\"y\":451.0},{\"x\":108.0,\"y\":503.0},{\"x\":15.0,\"y\":503.0}]},\"inferText\":\"원재료명\",\"inferConfidence\":0.9999,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":110.0,\"y\":419.0},{\"x\":241.0,\"y\":419.0},{\"x\":241.0,\"y\":481.0},{\"x\":110.0,\"y\":481.0}]},\"inferText\":\"대두(외국산),\",\"inferConfidence\":0.9993,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":227.0,\"y\":419.0},{\"x\":435.0,\"y\":411.0},{\"x\":438.0,\"y\":472.0},{\"x\":230.0,\"y\":480.0}]},\"inferText\":\"콘글루텐(뉴질랜드산)],\",\"inferConfidence\":0.9956,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":425.0,\"y\":412.0},{\"x\":603.0,\"y\":410.0},{\"x\":603.0,\"y\":469.0},{\"x\":425.0,\"y\":471.0}]},\"inferText\":\"한우지방(한우:국산),\",\"inferConfidence\":0.9991,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":592.0,\"y\":413.0},{\"x\":635.0,\"y\":413.0},{\"x\":635.0,\"y\":460.0},{\"x\":592.0,\"y\":460.0}]},\"inferText\":\"말토\",\"inferConfidence\":0.9963,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":113.0,\"y\":481.0},{\"x\":192.0,\"y\":481.0},{\"x\":192.0,\"y\":532.0},{\"x\":113.0,\"y\":532.0}]},\"inferText\":\"덱스트린,\",\"inferConfidence\":0.9997,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":181.0,\"y\":477.0},{\"x\":604.0,\"y\":461.0},{\"x\":607.0,\"y\":521.0},{\"x\":183.0,\"y\":538.0}]},\"inferText\":\".정제우지(우지:호주산),쇠고기액기스(쇠고기:호주산),\",\"inferConfidence\":0.9164,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":594.0,\"y\":467.0},{\"x\":636.0,\"y\":467.0},{\"x\":636.0,\"y\":507.0},{\"x\":594.0,\"y\":507.0}]},\"inferText\":\"아미\",\"inferConfidence\":0.9872,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":28.0,\"y\":508.0},{\"x\":54.0,\"y\":508.0},{\"x\":54.0,\"y\":549.0},{\"x\":28.0,\"y\":549.0}]},\"inferText\":\"및\",\"inferConfidence\":1.0,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":51.0,\"y\":503.0},{\"x\":105.0,\"y\":503.0},{\"x\":105.0,\"y\":554.0},{\"x\":51.0,\"y\":554.0}]},\"inferText\":\"함량\",\"inferConfidence\":1.0,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":115.0,\"y\":537.0},{\"x\":212.0,\"y\":537.0},{\"x\":212.0,\"y\":588.0},{\"x\":115.0,\"y\":588.0}]},\"inferText\":\"노산베이스,\",\"inferConfidence\":0.9992,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":203.0,\"y\":537.0},{\"x\":330.0,\"y\":532.0},{\"x\":332.0,\"y\":582.0},{\"x\":205.0,\"y\":587.0}]},\"inferText\":\"진한국물베이스,\",\"inferConfidence\":0.9583,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":318.0,\"y\":529.0},{\"x\":519.0,\"y\":518.0},{\"x\":522.0,\"y\":575.0},{\"x\":321.0,\"y\":586.0}]},\"inferText\":\"고기국물맛분말, 소스류,\",\"inferConfidence\":0.9859,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":507.0,\"y\":525.0},{\"x\":639.0,\"y\":519.0},{\"x\":641.0,\"y\":567.0},{\"x\":509.0,\"y\":573.0}]},\"inferText\":\"콩발효추출물분말,\",\"inferConfidence\":0.9721,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":118.0,\"y\":588.0},{\"x\":214.0,\"y\":588.0},{\"x\":214.0,\"y\":638.0},{\"x\":118.0,\"y\":638.0}]},\"inferText\":\"효모엑기스,\",\"inferConfidence\":0.9992,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":205.0,\"y\":586.0},{\"x\":307.0,\"y\":586.0},{\"x\":307.0,\"y\":637.0},{\"x\":205.0,\"y\":637.0}]},\"inferText\":\"향미증진제1,\",\"inferConfidence\":0.9992,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":296.0,\"y\":583.0},{\"x\":421.0,\"y\":579.0},{\"x\":423.0,\"y\":629.0},{\"x\":298.0,\"y\":633.0}]},\"inferText\":\"효모베이스분말,\",\"inferConfidence\":0.9956,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":411.0,\"y\":577.0},{\"x\":490.0,\"y\":577.0},{\"x\":490.0,\"y\":626.0},{\"x\":411.0,\"y\":626.0}]},\"inferText\":\",무즙분말,\",\"inferConfidence\":0.9464,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":478.0,\"y\":575.0},{\"x\":577.0,\"y\":572.0},{\"x\":578.0,\"y\":622.0},{\"x\":479.0,\"y\":625.0}]},\"inferText\":\"향미증진제2,\",\"inferConfidence\":0.9888,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":567.0,\"y\":568.0},{\"x\":639.0,\"y\":568.0},{\"x\":639.0,\"y\":617.0},{\"x\":567.0,\"y\":617.0}]},\"inferText\":\", 세이버리\",\"inferConfidence\":0.9763,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":121.0,\"y\":638.0},{\"x\":185.0,\"y\":638.0},{\"x\":185.0,\"y\":687.0},{\"x\":121.0,\"y\":687.0}]},\"inferText\":\"인핸서,\",\"inferConfidence\":0.9592,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":172.0,\"y\":638.0},{\"x\":311.0,\"y\":631.0},{\"x\":314.0,\"y\":681.0},{\"x\":174.0,\"y\":688.0}]},\"inferText\":\", 스튜드비프후레바,\",\"inferConfidence\":0.9277,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":301.0,\"y\":631.0},{\"x\":422.0,\"y\":627.0},{\"x\":423.0,\"y\":677.0},{\"x\":302.0,\"y\":681.0}]},\"inferText\":\"효모추출물제품,\",\"inferConfidence\":0.9639,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":413.0,\"y\":625.0},{\"x\":503.0,\"y\":625.0},{\"x\":503.0,\"y\":674.0},{\"x\":413.0,\"y\":674.0}]},\"inferText\":\"구운양파향,\",\"inferConfidence\":0.9973,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":491.0,\"y\":623.0},{\"x\":607.0,\"y\":617.0},{\"x\":610.0,\"y\":666.0},{\"x\":493.0,\"y\":672.0}]},\"inferText\":\"마늘양파혼합분,\",\"inferConfidence\":0.9954,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":598.0,\"y\":617.0},{\"x\":639.0,\"y\":617.0},{\"x\":639.0,\"y\":663.0},{\"x\":598.0,\"y\":663.0}]},\"inferText\":\"향미\",\"inferConfidence\":0.8,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":123.0,\"y\":693.0},{\"x\":195.0,\"y\":693.0},{\"x\":195.0,\"y\":742.0},{\"x\":123.0,\"y\":742.0}]},\"inferText\":\"증진제3,\",\"inferConfidence\":0.9987,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":185.0,\"y\":689.0},{\"x\":274.0,\"y\":689.0},{\"x\":274.0,\"y\":741.0},{\"x\":185.0,\"y\":741.0}]},\"inferText\":\"영양강화제\",\"inferConfidence\":0.9625,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":267.0,\"y\":682.0},{\"x\":369.0,\"y\":677.0},{\"x\":372.0,\"y\":735.0},{\"x\":270.0,\"y\":739.0}]},\"inferText\":\"특정성분\",\"inferConfidence\":0.9863,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":360.0,\"y\":677.0},{\"x\":412.0,\"y\":677.0},{\"x\":412.0,\"y\":732.0},{\"x\":360.0,\"y\":732.0}]},\"inferText\":\"함량\",\"inferConfidence\":1.0,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":406.0,\"y\":688.0},{\"x\":419.0,\"y\":688.0},{\"x\":419.0,\"y\":719.0},{\"x\":406.0,\"y\":719.0}]},\"inferText\":\":\",\"inferConfidence\":0.9996,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":413.0,\"y\":671.0},{\"x\":515.0,\"y\":671.0},{\"x\":515.0,\"y\":730.0},{\"x\":413.0,\"y\":730.0}]},\"inferText\":\"한우쇠고기\",\"inferConfidence\":0.9983,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":509.0,\"y\":676.0},{\"x\":536.0,\"y\":676.0},{\"x\":536.0,\"y\":718.0},{\"x\":509.0,\"y\":718.0}]},\"inferText\":\"10\",\"inferConfidence\":1.0,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":527.0,\"y\":666.0},{\"x\":640.0,\"y\":661.0},{\"x\":643.0,\"y\":721.0},{\"x\":529.0,\"y\":726.0}]},\"inferText\":\"%(정육기준)\",\"inferConfidence\":0.9994,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":129.0,\"y\":744.0},{\"x\":229.0,\"y\":744.0},{\"x\":229.0,\"y\":801.0},{\"x\":129.0,\"y\":801.0}]},\"inferText\":\"쇠고기,\",\"inferConfidence\":0.9999,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":224.0,\"y\":742.0},{\"x\":323.0,\"y\":742.0},{\"x\":323.0,\"y\":799.0},{\"x\":224.0,\"y\":799.0}]},\"inferText\":\"닭고기,\",\"inferConfidence\":0.998,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":318.0,\"y\":738.0},{\"x\":391.0,\"y\":738.0},{\"x\":391.0,\"y\":795.0},{\"x\":318.0,\"y\":795.0}]},\"inferText\":\"대두,\",\"inferConfidence\":1.0,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":385.0,\"y\":736.0},{\"x\":581.0,\"y\":725.0},{\"x\":584.0,\"y\":782.0},{\"x\":388.0,\"y\":793.0}]},\"inferText\":\"밀,우유,조개류\",\"inferConfidence\":0.9891,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":576.0,\"y\":721.0},{\"x\":640.0,\"y\":721.0},{\"x\":640.0,\"y\":778.0},{\"x\":576.0,\"y\":778.0}]},\"inferText\":\"함유\",\"inferConfidence\":1.0,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":33.0,\"y\":800.0},{\"x\":128.0,\"y\":798.0},{\"x\":129.0,\"y\":843.0},{\"x\":34.0,\"y\":845.0}]},\"inferText\":\"용기(포장)재질\",\"inferConfidence\":0.9991,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":134.0,\"y\":796.0},{\"x\":322.0,\"y\":792.0},{\"x\":322.0,\"y\":840.0},{\"x\":135.0,\"y\":843.0}]},\"inferText\":\"폴리에틸렌(내면)\",\"inferConfidence\":0.9999,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":337.0,\"y\":793.0},{\"x\":442.0,\"y\":789.0},{\"x\":444.0,\"y\":832.0},{\"x\":338.0,\"y\":836.0}]},\"inferText\":\"품목보고번호\",\"inferConfidence\":0.9996,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":447.0,\"y\":788.0},{\"x\":630.0,\"y\":775.0},{\"x\":633.0,\"y\":816.0},{\"x\":450.0,\"y\":829.0}]},\"inferText\":\"19910144038478\",\"inferConfidence\":0.9995,\"type\":\"NORMAL\",\"lineBreak\":true}]}],\"originalFileName\":\"KakaoTalk_20240924_103821905_09\",\"imageType\":\"jpg\"}";
//            String ocrResponse = "{\"version\":\"V2\",\"requestId\":\"0945e5fb-ad5a-41d1-b6bf-6a0e3a3f1ab7\",\"timestamp\":1727453140266,\"images\":[{\"uid\":\"66ac239cd73d418ba48f58471be85329\",\"name\":\"demo\",\"inferResult\":\"SUCCESS\",\"message\":\"SUCCESS\",\"validationResult\":{\"result\":\"NO_REQUESTED\"},\"convertedImageInfo\":{\"width\":900,\"height\":1502,\"pageIndex\":0,\"longImage\":false},\"fields\":[{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":148.0,\"y\":36.0},{\"x\":233.0,\"y\":36.0},{\"x\":233.0,\"y\":106.0},{\"x\":148.0,\"y\":106.0}]},\"inferText\":\"뚜껑\",\"inferConfidence\":0.9998,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":229.0,\"y\":35.0},{\"x\":318.0,\"y\":35.0},{\"x\":318.0,\"y\":109.0},{\"x\":229.0,\"y\":109.0}]},\"inferText\":\"회전\",\"inferConfidence\":0.9883,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":318.0,\"y\":43.0},{\"x\":358.0,\"y\":43.0},{\"x\":358.0,\"y\":103.0},{\"x\":318.0,\"y\":103.0}]},\"inferText\":\"시\",\"inferConfidence\":0.9999,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":362.0,\"y\":38.0},{\"x\":552.0,\"y\":42.0},{\"x\":551.0,\"y\":116.0},{\"x\":361.0,\"y\":112.0}]},\"inferText\":\"내부온박이\",\"inferConfidence\":0.9038,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":549.0,\"y\":43.0},{\"x\":743.0,\"y\":50.0},{\"x\":740.0,\"y\":124.0},{\"x\":546.0,\"y\":116.0}]},\"inferText\":\"개봉됩니다.\",\"inferConfidence\":1.0,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":125.0,\"y\":113.0},{\"x\":473.0,\"y\":118.0},{\"x\":472.0,\"y\":186.0},{\"x\":124.0,\"y\":180.0}]},\"inferText\":\"식품유형 과채주스\",\"inferConfidence\":0.9834,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":127.0,\"y\":177.0},{\"x\":292.0,\"y\":177.0},{\"x\":292.0,\"y\":243.0},{\"x\":127.0,\"y\":243.0}]},\"inferText\":\"소비기한\",\"inferConfidence\":0.9995,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":295.0,\"y\":179.0},{\"x\":669.0,\"y\":189.0},{\"x\":667.0,\"y\":256.0},{\"x\":294.0,\"y\":245.0}]},\"inferText\":\"제품 상단 표기일까지\",\"inferConfidence\":0.9945,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":133.0,\"y\":264.0},{\"x\":286.0,\"y\":264.0},{\"x\":286.0,\"y\":338.0},{\"x\":133.0,\"y\":338.0}]},\"inferText\":\"제조원\",\"inferConfidence\":0.9996,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":297.0,\"y\":243.0},{\"x\":629.0,\"y\":251.0},{\"x\":627.0,\"y\":320.0},{\"x\":295.0,\"y\":312.0}]},\"inferText\":\"롯데칠성음료(주)\",\"inferConfidence\":0.9996,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":627.0,\"y\":253.0},{\"x\":755.0,\"y\":255.0},{\"x\":753.0,\"y\":324.0},{\"x\":625.0,\"y\":322.0}]},\"inferText\":\"경기도\",\"inferConfidence\":0.9999,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":295.0,\"y\":301.0},{\"x\":546.0,\"y\":308.0},{\"x\":544.0,\"y\":374.0},{\"x\":294.0,\"y\":367.0}]},\"inferText\":\"광주시 양벌로\",\"inferConfidence\":0.9997,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":540.0,\"y\":312.0},{\"x\":630.0,\"y\":312.0},{\"x\":630.0,\"y\":367.0},{\"x\":540.0,\"y\":367.0}]},\"inferText\":\"257\",\"inferConfidence\":1.0,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":294.0,\"y\":364.0},{\"x\":750.0,\"y\":376.0},{\"x\":748.0,\"y\":444.0},{\"x\":292.0,\"y\":432.0}]},\"inferText\":\"정제수,적포도청징농축액\",\"inferConfidence\":0.9966,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":295.0,\"y\":422.0},{\"x\":559.0,\"y\":427.0},{\"x\":558.0,\"y\":489.0},{\"x\":294.0,\"y\":484.0}]},\"inferText\":\"(포도과즙88.6\",\"inferConfidence\":0.9937,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":557.0,\"y\":429.0},{\"x\":746.0,\"y\":431.0},{\"x\":745.0,\"y\":495.0},{\"x\":556.0,\"y\":493.0}]},\"inferText\":\"%,칠레산),\",\"inferConfidence\":0.9954,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":134.0,\"y\":488.0},{\"x\":288.0,\"y\":488.0},{\"x\":288.0,\"y\":555.0},{\"x\":134.0,\"y\":555.0}]},\"inferText\":\"원재료명\",\"inferConfidence\":0.868,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":296.0,\"y\":474.0},{\"x\":743.0,\"y\":487.0},{\"x\":741.0,\"y\":553.0},{\"x\":294.0,\"y\":539.0}]},\"inferText\":\"적포도농축액(포도과즙\",\"inferConfidence\":0.9954,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":299.0,\"y\":533.0},{\"x\":470.0,\"y\":537.0},{\"x\":469.0,\"y\":591.0},{\"x\":298.0,\"y\":587.0}]},\"inferText\":\"11.4%,\",\"inferConfidence\":0.8839,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":478.0,\"y\":534.0},{\"x\":652.0,\"y\":537.0},{\"x\":650.0,\"y\":601.0},{\"x\":477.0,\"y\":598.0}]},\"inferText\":\"미국산),\",\"inferConfidence\":0.9985,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":646.0,\"y\":536.0},{\"x\":738.0,\"y\":536.0},{\"x\":738.0,\"y\":599.0},{\"x\":646.0,\"y\":599.0}]},\"inferText\":\"천연\",\"inferConfidence\":1.0,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":297.0,\"y\":583.0},{\"x\":551.0,\"y\":588.0},{\"x\":550.0,\"y\":652.0},{\"x\":295.0,\"y\":647.0}]},\"inferText\":\"향료(포도향),\",\"inferConfidence\":0.9975,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":547.0,\"y\":587.0},{\"x\":679.0,\"y\":587.0},{\"x\":679.0,\"y\":652.0},{\"x\":547.0,\"y\":652.0}]},\"inferText\":\"구연산\",\"inferConfidence\":0.9998,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":134.0,\"y\":645.0},{\"x\":372.0,\"y\":650.0},{\"x\":371.0,\"y\":713.0},{\"x\":133.0,\"y\":708.0}]},\"inferText\":\"품목보고번호\",\"inferConfidence\":0.999,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":381.0,\"y\":653.0},{\"x\":729.0,\"y\":659.0},{\"x\":728.0,\"y\":712.0},{\"x\":380.0,\"y\":706.0}]},\"inferText\":\"19780368002138\",\"inferConfidence\":0.9997,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":133.0,\"y\":707.0},{\"x\":375.0,\"y\":711.0},{\"x\":374.0,\"y\":772.0},{\"x\":132.0,\"y\":768.0}]},\"inferText\":\"용기·포장재질\",\"inferConfidence\":0.9971,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":381.0,\"y\":712.0},{\"x\":727.0,\"y\":716.0},{\"x\":727.0,\"y\":775.0},{\"x\":380.0,\"y\":771.0}]},\"inferText\":\"폴리에틸렌(내면)\",\"inferConfidence\":0.9998,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":136.0,\"y\":773.0},{\"x\":730.0,\"y\":781.0},{\"x\":729.0,\"y\":844.0},{\"x\":135.0,\"y\":836.0}]},\"inferText\":\"우유,메밀,땅콩,대두,밀,복숭아,토마\",\"inferConfidence\":0.9868,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":132.0,\"y\":825.0},{\"x\":496.0,\"y\":831.0},{\"x\":495.0,\"y\":891.0},{\"x\":131.0,\"y\":885.0}]},\"inferText\":\"토,아황산류,호두,잣을\",\"inferConfidence\":0.9994,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":494.0,\"y\":833.0},{\"x\":616.0,\"y\":833.0},{\"x\":616.0,\"y\":889.0},{\"x\":494.0,\"y\":889.0}]},\"inferText\":\"사용한\",\"inferConfidence\":0.9996,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":612.0,\"y\":831.0},{\"x\":727.0,\"y\":831.0},{\"x\":727.0,\"y\":889.0},{\"x\":612.0,\"y\":889.0}]},\"inferText\":\"제품과\",\"inferConfidence\":0.9998,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":131.0,\"y\":874.0},{\"x\":216.0,\"y\":874.0},{\"x\":216.0,\"y\":935.0},{\"x\":131.0,\"y\":935.0}]},\"inferText\":\"같은\",\"inferConfidence\":1.0,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":213.0,\"y\":877.0},{\"x\":370.0,\"y\":877.0},{\"x\":370.0,\"y\":936.0},{\"x\":213.0,\"y\":936.0}]},\"inferText\":\"시설에서\",\"inferConfidence\":1.0,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":371.0,\"y\":882.0},{\"x\":531.0,\"y\":882.0},{\"x\":531.0,\"y\":939.0},{\"x\":371.0,\"y\":939.0}]},\"inferText\":\"제조하고\",\"inferConfidence\":1.0,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":531.0,\"y\":884.0},{\"x\":727.0,\"y\":881.0},{\"x\":727.0,\"y\":939.0},{\"x\":531.0,\"y\":941.0}]},\"inferText\":\"있습니다.·이\",\"inferConfidence\":0.9842,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":135.0,\"y\":925.0},{\"x\":322.0,\"y\":931.0},{\"x\":320.0,\"y\":986.0},{\"x\":133.0,\"y\":979.0}]},\"inferText\":\"~10°C에서\",\"inferConfidence\":0.9996,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":322.0,\"y\":929.0},{\"x\":477.0,\"y\":929.0},{\"x\":477.0,\"y\":987.0},{\"x\":322.0,\"y\":987.0}]},\"inferText\":\"냉장보관\",\"inferConfidence\":1.0,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":477.0,\"y\":933.0},{\"x\":684.0,\"y\":933.0},{\"x\":684.0,\"y\":988.0},{\"x\":477.0,\"y\":988.0}]},\"inferText\":\"하세요.·개봉\",\"inferConfidence\":0.9289,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":680.0,\"y\":932.0},{\"x\":723.0,\"y\":932.0},{\"x\":723.0,\"y\":984.0},{\"x\":680.0,\"y\":984.0}]},\"inferText\":\"후\",\"inferConfidence\":1.0,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":133.0,\"y\":972.0},{\"x\":357.0,\"y\":978.0},{\"x\":355.0,\"y\":1037.0},{\"x\":132.0,\"y\":1031.0}]},\"inferText\":\"냉장보관하여\",\"inferConfidence\":1.0,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":355.0,\"y\":979.0},{\"x\":439.0,\"y\":979.0},{\"x\":439.0,\"y\":1037.0},{\"x\":355.0,\"y\":1037.0}]},\"inferText\":\"빨리\",\"inferConfidence\":1.0,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":439.0,\"y\":981.0},{\"x\":648.0,\"y\":983.0},{\"x\":648.0,\"y\":1039.0},{\"x\":438.0,\"y\":1037.0}]},\"inferText\":\"드세요.·제품\",\"inferConfidence\":0.9688,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":642.0,\"y\":980.0},{\"x\":723.0,\"y\":980.0},{\"x\":723.0,\"y\":1035.0},{\"x\":642.0,\"y\":1035.0}]},\"inferText\":\"고유\",\"inferConfidence\":0.9998,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":133.0,\"y\":1025.0},{\"x\":178.0,\"y\":1025.0},{\"x\":178.0,\"y\":1077.0},{\"x\":133.0,\"y\":1077.0}]},\"inferText\":\"의\",\"inferConfidence\":0.9988,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":176.0,\"y\":1023.0},{\"x\":329.0,\"y\":1026.0},{\"x\":328.0,\"y\":1084.0},{\"x\":175.0,\"y\":1081.0}]},\"inferText\":\"침전물이\",\"inferConfidence\":0.9995,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":330.0,\"y\":1027.0},{\"x\":412.0,\"y\":1027.0},{\"x\":412.0,\"y\":1085.0},{\"x\":330.0,\"y\":1085.0}]},\"inferText\":\"생길\",\"inferConfidence\":0.9999,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":413.0,\"y\":1031.0},{\"x\":460.0,\"y\":1031.0},{\"x\":460.0,\"y\":1085.0},{\"x\":413.0,\"y\":1085.0}]},\"inferText\":\"수\",\"inferConfidence\":1.0,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":459.0,\"y\":1030.0},{\"x\":577.0,\"y\":1030.0},{\"x\":577.0,\"y\":1088.0},{\"x\":459.0,\"y\":1088.0}]},\"inferText\":\"있으나\",\"inferConfidence\":1.0,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":574.0,\"y\":1030.0},{\"x\":721.0,\"y\":1027.0},{\"x\":722.0,\"y\":1085.0},{\"x\":576.0,\"y\":1088.0}]},\"inferText\":\"품질에는\",\"inferConfidence\":1.0,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":133.0,\"y\":1069.0},{\"x\":249.0,\"y\":1073.0},{\"x\":246.0,\"y\":1132.0},{\"x\":131.0,\"y\":1128.0}]},\"inferText\":\"이상이\",\"inferConfidence\":0.9999,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":247.0,\"y\":1075.0},{\"x\":523.0,\"y\":1081.0},{\"x\":521.0,\"y\":1137.0},{\"x\":246.0,\"y\":1131.0}]},\"inferText\":\"없습니다.용기의\",\"inferConfidence\":0.9336,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":520.0,\"y\":1080.0},{\"x\":720.0,\"y\":1074.0},{\"x\":721.0,\"y\":1133.0},{\"x\":522.0,\"y\":1139.0}]},\"inferText\":\"변형,팽창,손\",\"inferConfidence\":0.9983,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":133.0,\"y\":1118.0},{\"x\":224.0,\"y\":1118.0},{\"x\":224.0,\"y\":1176.0},{\"x\":133.0,\"y\":1176.0}]},\"inferText\":\"상 및\",\"inferConfidence\":0.9068,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":220.0,\"y\":1122.0},{\"x\":339.0,\"y\":1122.0},{\"x\":339.0,\"y\":1180.0},{\"x\":220.0,\"y\":1180.0}]},\"inferText\":\"내용물\",\"inferConfidence\":1.0,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":337.0,\"y\":1125.0},{\"x\":452.0,\"y\":1125.0},{\"x\":452.0,\"y\":1183.0},{\"x\":337.0,\"y\":1183.0}]},\"inferText\":\"변질시\",\"inferConfidence\":0.9998,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":451.0,\"y\":1126.0},{\"x\":602.0,\"y\":1126.0},{\"x\":602.0,\"y\":1184.0},{\"x\":451.0,\"y\":1184.0}]},\"inferText\":\"음용하지\",\"inferConfidence\":0.9998,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":600.0,\"y\":1130.0},{\"x\":718.0,\"y\":1123.0},{\"x\":721.0,\"y\":1179.0},{\"x\":603.0,\"y\":1186.0}]},\"inferText\":\"마세요.\",\"inferConfidence\":0.9998,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":138.0,\"y\":1169.0},{\"x\":716.0,\"y\":1171.0},{\"x\":716.0,\"y\":1233.0},{\"x\":138.0,\"y\":1232.0}]},\"inferText\":\"소비자분쟁해결기준(공정위고시)에\",\"inferConfidence\":0.9962,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":131.0,\"y\":1212.0},{\"x\":215.0,\"y\":1212.0},{\"x\":215.0,\"y\":1271.0},{\"x\":131.0,\"y\":1271.0}]},\"inferText\":\"의거\",\"inferConfidence\":0.9994,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":207.0,\"y\":1218.0},{\"x\":294.0,\"y\":1218.0},{\"x\":294.0,\"y\":1275.0},{\"x\":207.0,\"y\":1275.0}]},\"inferText\":\"교환\",\"inferConfidence\":0.9999,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":288.0,\"y\":1220.0},{\"x\":373.0,\"y\":1220.0},{\"x\":373.0,\"y\":1277.0},{\"x\":288.0,\"y\":1277.0}]},\"inferText\":\"또는\",\"inferConfidence\":1.0,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":372.0,\"y\":1222.0},{\"x\":522.0,\"y\":1225.0},{\"x\":521.0,\"y\":1281.0},{\"x\":371.0,\"y\":1278.0}]},\"inferText\":\"보상받을\",\"inferConfidence\":0.9996,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":519.0,\"y\":1224.0},{\"x\":566.0,\"y\":1224.0},{\"x\":566.0,\"y\":1278.0},{\"x\":519.0,\"y\":1278.0}]},\"inferText\":\"수\",\"inferConfidence\":1.0,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":562.0,\"y\":1225.0},{\"x\":717.0,\"y\":1217.0},{\"x\":720.0,\"y\":1273.0},{\"x\":565.0,\"y\":1281.0}]},\"inferText\":\"있습니다.\",\"inferConfidence\":1.0,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":140.0,\"y\":1262.0},{\"x\":716.0,\"y\":1266.0},{\"x\":716.0,\"y\":1329.0},{\"x\":139.0,\"y\":1325.0}]},\"inferText\":\"교환:롯데칠성음료(주)고객만족팀(\",\"inferConfidence\":0.945,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":136.0,\"y\":1310.0},{\"x\":474.0,\"y\":1319.0},{\"x\":473.0,\"y\":1371.0},{\"x\":134.0,\"y\":1362.0}]},\"inferText\":\"080-730-1472)및\",\"inferConfidence\":0.9981,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":471.0,\"y\":1317.0},{\"x\":711.0,\"y\":1314.0},{\"x\":711.0,\"y\":1370.0},{\"x\":472.0,\"y\":1373.0}]},\"inferText\":\"구입처·부정·불\",\"inferConfidence\":0.9989,\"type\":\"NORMAL\",\"lineBreak\":true},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":134.0,\"y\":1352.0},{\"x\":249.0,\"y\":1352.0},{\"x\":249.0,\"y\":1412.0},{\"x\":134.0,\"y\":1412.0}]},\"inferText\":\"량식품\",\"inferConfidence\":0.9995,\"type\":\"NORMAL\",\"lineBreak\":false},{\"valueType\":\"ALL\",\"boundingPoly\":{\"vertices\":[{\"x\":244.0,\"y\":1360.0},{\"x\":709.0,\"y\":1358.0},{\"x\":710.0,\"y\":1414.0},{\"x\":244.0,\"y\":1415.0}]},\"inferText\":\"신고:국번없이1399질소충전\",\"inferConfidence\":0.9952,\"type\":\"NORMAL\",\"lineBreak\":true}]}]}";


            processedText = ocrService.parseJson(ocrResponse); // 응답 텍스트 전처리

            // 등록 제품 판단
            Product product = productService.getProduct(processedText.getReportNum());
            if (product != null) processedText.setExists(true);

            // 괄호 검사
            if (!processedText.isFullBracket())
                return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(processedText); // 400 Bad Request
            return ResponseEntity.ok(processedText);
        } catch (Exception e) {
            return new ResponseEntity<>(HttpStatus.INTERNAL_SERVER_ERROR); // 500 Sever Error
        }
    }

    // 제품 판독 및 추천
    @PostMapping
    public ResponseEntity<IngredientResponse> checkIngredients(@Valid @RequestBody IngredientRequest request) {
        List<String> ingredients;

        Long proId = null;
        Integer proVegTypeId = null;
        Integer userVegTypeId = request.getVegTypeId();

        // 등록 제품 처리
        if (request.isExists()) {
            Product product = productService.getProduct(request.getReportNum());
            proVegTypeId = product.getVegType().getId();
            proId = product.getId();
            ingredients = IngredientUtil.splitByCommaOutsideBrackets(product.getIngredients());
        } else {
            List<String> ingredientList = Collections.singletonList(request.getIngredients());
            ingredientList = IngredientUtil.processIngredients(ingredientList);

            // 괄호 검사
            if (ingredientList == null) return new ResponseEntity<>(HttpStatus.BAD_REQUEST); // 400 Bad Request

            // 불필요한 문자 제거
            if (!request.isFullBracket())
                ingredientList = IngredientUtil.extractCleanIngredient(ingredientList);

            ingredients = IngredientUtil.splitByCommaOutsideBrackets(String.join(", ", ingredientList));
        }

        // 제품 판독
        IngredientResponse result = readingService.checkConsumable(ingredients, userVegTypeId, proVegTypeId);

        // 유사품 추천
        List<ProductDTO> products = recommendationService.recommendByReading(userVegTypeId, result.getConsumables().toString());

        result.setProId(proId);
        result.setReportNum(request.getReportNum());
        result.setRecommendations(products);
        return ResponseEntity.ok(result);
    }
}